<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My Books API</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <style>
    .card:hover {
      box-shadow: 3px 3px 3px;
    }
  </style>
</head>

<body id="body">
  <div class="container">
    <div class="row mt-5">
      <div class="col">
        <h1 class="display-3">My Books</h1>
        <button class="btn btn-primary" onclick="loadBooks('want-to-read')">Want to Read</button>
        <button class="btn btn-secondary" onclick="loadBooks('currently-reading')">Currently Reading</button>
        <button class="btn btn-success" onclick="loadBooks('already-read')">Already Read</button>
      </div>
    </div>
    <div class="row mt-5">
      <div class="col" id="bookContainer">
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
  </script>

  <script>
    const bookContainer = document.getElementById("bookContainer");

    // Simulated authentication check (replace with real check)
    const isAuthenticated = true; // Set to false for testing unauthenticated state

    const loadBooks = async (listType) => {
      if (!isAuthenticated) {
        bookContainer.innerHTML = `<p>Please log in to view your reading lists.</p>`;
        return;
      }

      bookContainer.innerHTML = "";
      let url = '';

      if (listType === 'want-to-read') {
        url = 'https://openlibrary.org/george08/mekBot/books/want-to-read.json';
      } else if (listType === 'currently-reading') {
        url = 'https://openlibrary.org/george08/mekBot/books/currently-reading.json';
      } else if (listType === 'already-read') {
        url = 'https://openlibrary.org/george08/mekBot/books/already-read.json';
      }

      try {
        const response = await fetch(url);
        const data = await response.json();
        console.log(data); // Log the entire response for inspection

        const books = data.books || []; // Use an empty array if books are undefined

        // Check if books exist and display titles
        if (books.length === 0) {
          bookContainer.innerHTML = `<p>No books found in this list.</p>`;
        } else {
          books.forEach(book => {
            bookContainer.innerHTML += `
              <a href="https://openlibrary.org${book.key}" target="_blank">
                <button type="button" class="btn btn-outline-dark m-2">${book.title}</button>
              </a>
            `;
          });
        }
      } catch (error) {
        console.error('Error fetching data:', error);
        bookContainer.innerHTML = `<p>Error fetching data. Please try again later.</p>`;
      }
    }
  </script>
</body>

</html>
